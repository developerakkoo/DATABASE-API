var Converter = require('csvtojson').Converter;
const XlsxPopulate = require('xlsx-populate');

module.exports = function (inputfile, output_file, callback) {
    var converter = new Converter({});
    
    converter.fromFile(inputfile).then( function ( result) {
        
        var header = Object.keys(result[0])
        console.log(header)
        XlsxPopulate.fromBlankAsync()
            .then(workbook => {
                var c = 2;
                for (var val1 = 0; val1 < header.length; val1++) {
                    var chr = String.fromCharCode(65 + val1);
                    workbook.sheet("Sheet1").cell(chr + '' + 1).value(header[val1]);
                }
                for (var val = 0; val < result.length; val++) {
                    for (var val1 = 0; val1 < header.length; val1++) {
                        var chr = String.fromCharCode(65 + val1);
                        workbook.sheet("Sheet1").cell(chr + '' + c).value(result[val][header[val1]]);
                    }
                    c++;
                }

                return workbook.toFileAsync(output_file);
            });

        callback();
    });

};



